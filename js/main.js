    //массив адресов обоев
    let wallpaper = [
        {   "title" : "popular",
            "title-rus" : "Популярное",
            "image": [
                "https://klevtsovaelena.github.io/wallpaper/img/1.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/2.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/3.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/4.png",
                "https://klevtsovaelena.github.io/wallpaper/img/5.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/6.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/7.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/8.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/9.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/10.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/11.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/12.jpg",
                
            ]
        },
        {   "title" : "black_white",
            "title-rus" : "Чёрно-белое",
            "image": [
                "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite1.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite2.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite3.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite4.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite5.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite6.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite7.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite8.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite9.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite10.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite11.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite12.jpg",
                
            ]
        },
        {   "title" : "north_lights",
            "title-rus" : "Северное сияние",
            "image": [
                "https://klevtsovaelena.github.io/wallpaper/img/Shine1.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Shine2.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Shine3.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Shine4.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Shine5.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Shine6.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Shine7.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Shine8.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Shine9.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Shine10.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Shine11.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Shine12.jpg",
                
            ]
        },
        {   "title" : "winter",
            "title-rus" : "Зима",
            "image": [
                "https://klevtsovaelena.github.io/wallpaper/img/Winter1.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Winter2.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Winter3.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Winter4.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Winter5.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Winter6.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Winter7.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Winter8.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Winter9.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Winter10.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Winter11.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Winter12.jpg",
                
            ]
        },
        {   "title" : "fire",
            "title-rus" : "Фейерверки",
            "image": [
                "https://klevtsovaelena.github.io/wallpaper/img/Fire1.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Fire2.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Fire3.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Fire4.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Fire5.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Fire6.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Fire7.jpeg",
                "https://klevtsovaelena.github.io/wallpaper/img/Fire8.png",
                "https://klevtsovaelena.github.io/wallpaper/img/Fire9.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Fire10.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Fire11.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Fire12.jpg",
                
            ]
        },
        {   "title" : "flower",
            "title-rus" : "Цветы",
            "image": [
                "https://klevtsovaelena.github.io/wallpaper/img/Flower1.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Flower2.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Flower3.jpeg",
                "https://klevtsovaelena.github.io/wallpaper/img/Flower4.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Flower5.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Flower6.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Flower7.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Flower8.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Flower9.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Flower10.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Flower11.jpg",
                "https://klevtsovaelena.github.io/wallpaper/img/Flower12.jpg",
            ]
        },
      ]

    //адрес юзера в телеграмм
    let chat_id = 1752911328;

    //создаем модель таскборда
    let data = localStorage.getItem('boards');
    console.log(data)

    //если нет сохраненного то выдаем стартовый объект
    if (data == null) {
        //перезаписываем data
        data = {
            "boards":[
                {
                    "title":"Новая доска",
                    "background": "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite11.jpg",
                    "columns":[
                        {
                            "title":"Новая колонка",
                            "cards":[]
                        }
                    ]
                }
            ]
        };
    } else {
        data = JSON.parse(data);
        if (data['boards'].length == 0) {
            //перезаписываем data
            data = {
                "boards":[
                    {
                        "title":"Новая доска",
                        "background": "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite11.jpg",
                        "columns":[
                            {
                                "title":"Новая колонка",
                                "cards":[]
                            }
                        ]
                    }
                ]
            };
        }
    }

    //номер текущий доски
    let currentBoardId = localStorage.getItem('current_board');
    if (currentBoardId == null) {
        currentBoardId = 0;
    }
    console.log(data);

    renderBoards();
    renderWallpapers();


    //запускаем рассыльщик через каждые 5 секунд
    setInterval(function(){
        sender();
   }, 5000)
    

    //функция сохранения
    function save() {

        //кодируем data в json
        let dataJson = JSON.stringify(data);

        //сохраняем в localStorage
        localStorage.setItem('boards',dataJson);

        //сохраняем номер текущей доски
        localStorage.setItem('current_board', currentBoardId);
    }

    //функция отрисовки досок
    function renderBoards() {



        //получаем шаблоны
        let tmpl_board = document.getElementById('tmpl-board').innerHTML;
        let tmpl_column = document.getElementById('tmpl-column').innerHTML;
        let tmpl_card = document.getElementById('tmpl-card').innerHTML;

        //находим контейнер под доски
        let container = document.getElementById('boards');

        //очищаем доски
        container.innerHTML = '';

        //в цикле подставляем данные в шаблоны (СОБИРАЕМ ДОСКИ)
        for (let i = 0; i < data['boards'].length; i++ ) {

            //если номер доски в списке не совпадает с номером текущей доски, то не рисуем её
            if (i != currentBoardId){
                continue;
            }

            //собираем html колонок доски  (СОБИРАЕМ КОЛОНКИ ДОСКИ)
            let boardColumns = '';
            for (let j = 0; j < data['boards'][i]['columns'].length; j++) { 

                //собираем html карточек колонки (СОБИРАЕМ КАРТОЧКИ КОЛОНКИ)
                let columnCards = '';
                for (let k = 0; k < data['boards'][i]['columns'][j]['cards'].length; k++) {

                    //html одной карточки
                    let cardHtml = tmpl_card.replace('${card_header}', data['boards'][i]['columns'][j]['cards'][k]['title'])
                                            .replace('${board_number}', i)                        
                                            .replace('${column_number}', j)
                                            .replace('${card_number}', k)
                                            .replace('${card_content}', data['boards'][i]['columns'][j]['cards'][k]['description'])  
                                            .replace('${card_notification}', data['boards'][i]['columns'][j]['cards'][k]['time'])
                                            .replace('${card_notification}', (data['boards'][i]['columns'][j]['cards'][k]['time'] != '') ? '&#x2709;' : '');
                    //добавляем готовый текст карточки к картокам КОЛОНКИ
                    columnCards += cardHtml;
                }

                //html одной колоночки
                let columnHtml = tmpl_column.replace('${column_header}',data['boards'][i]['columns'][j]['title'])
                                            .replace('${board_number}',i)
                                            .replace('${column_number}',j)
                                            .replace('${column_number}',j)
                                            .replace('${column_number}',j)
                                            .replace('${column_content}',columnCards);

                //добавляем готовый текст КОЛОНКИ к колонкам ДОСКИ
                boardColumns += columnHtml;

            }

            //подстваляем данные в шаблон доски и добавляем в контейнер
            container.innerHTML += tmpl_board.replace('${board_header}',data['boards'][i]['title'])
                                             .replace('${board_background}',data['boards'][i]['background']) 
                                             .replace('${board_number}',i) 
                                             .replace('${board_content}',boardColumns);
        }
        renderBoardsList();
    }

    //функция создания новой доски
    function boardAdd(){
        
        //сщздаём объект пустой доски
        let board = {
                        "title":"Новая доска",
                        "background": "https://klevtsovaelena.github.io/wallpaper/img/BlackWhite11.jpg",
                        "columns":[
                            {
                                "title":"Новая колонка",
                                "cards":[]
                            }
                        ]
                    };

        //добавляем объект в модель
        data['boards'].push(board);

        //переключаемся на новую доску
        currentBoardId = data['boards'].length - 1;

        //отрисовка новой доски
        renderBoards();

        //сохранение модели
        save();
    }

    //функция переименования доски
    function boardRename() {

        let name = event.target.value;

        data['boards'][currentBoardId]['title'] = name;

        save();
    }

    //функция для удаления доски
    function boardDelete() {

        //спросить подтверждение
        let ok = confirm("Вы действительно хотите удалить доску?");  //true / false

        if (ok) {

        //удаляем доску
        
        data['boards'].splice(currentBoardId, 1);
            
        //если была удалена последняя доска, то значение currentBoardId будет 
        //больше допустимого (индекс элемента за пределами массива),
        //в этом случае устанавливаем стартовое значение  currentBoardId = 0
        if (currentBoardId >=  data['boards'].length) {
            currentBoardId = 0;
        }    

        //сохраняем
        save();

        //если все доски удалены, то перезагружаем страницу. 
        //а при этом будет отрисована стартовая новая доска
        if (data['boards'].length == 0) {
            window.location.reload();
        } 

        //перерисовываем
        renderBoards();
        } 

    }
    //функция создания колонки
    function columnAdd(){

        //создаем пустую колонку
        let column = {
                        "title":"Новая колонка",
                        "cards":[]
                     }; 

        //добавляем колонку на доску
        data['boards'][currentBoardId]['columns'].push(column)  

        //вывести модель в консоль
        console.log(data);  

        //перерисовываем доски
        renderBoards();   

        save();     
        
    }

    //функция переименования колонки
    function columnRename(column_number) {

        //определяем содержимое инпута
        let name = event.target.value;

        //перезаписываем имя колонки в модели
        data['boards'][currentBoardId]['columns'][column_number]['title'] = name;

        //сохраняем
        save();
    }

    //функция для удаления колонок
    function columnDelete(column_number) {

        //спросить подтверждение
        let ok = confirm("Вы действительно хотите удалить колонку?");  //true / false

        if (ok) {

            //удаляем колонку из модели
            data['boards'][currentBoardId]['columns'].splice(column_number,1);

            //сохраняем
            save();

            //перерисовываем
            renderBoards();
        } 
        
    }

    //показать форму для заполнения названия и описания задачи
    function showAddCardForm(){
       
        let id_formCardAdd = event.target.closest('.column').querySelector('.formCardAdd');
     
        id_formCardAdd.style.display="block";
    }

    //функция добавления карточки(задачи)
    function cardAdd(board_number, column_number) {

        //создаем пустую карточку
        let card = {};

        //получить содержимое текстового поля
        let title = event.target.closest('.formCardAdd').querySelector('input').value;
        let description = event.target.closest('.formCardAdd').querySelector('textarea').value;
        let time = event.target.closest('.formCardAdd').querySelector('.card-time').value;

        //наполняем карточку полученными данными
        card['title'] = title;
        card['description'] = description;
        card['time'] = time;

        //добавить карточку в модель
        data['boards'][board_number]['columns'][column_number]['cards'].push(card);

        //вывести модель в консоль
        console.log(data);

        //перерисовываем доски
        renderBoards(); 

        save();
    }

    //функция удаления карточки
    function cardDelete(board_number, column_number, card_number) {

        //спросить подтверждение
        let ok = confirm("Вы действительно хотите удалить задачу?");  //true / false

        if (ok) {

            //удаляем колонку из модели
            data['boards'][board_number]['columns'][column_number]['cards'].splice(card_number,1);

            //сохраняем
            save();

            //перерисовываем
            renderBoards();
        } 

    }

    //отрисовка названий досок
    function renderBoardsList(){

         //находим контейнер для обоев  
         let container = document.getElementById('side-menu');

         //находим шаблон для обоев
         let tmpl_board = document.getElementById('tmpl-board-line').innerHTML;

         //очистим контейнер
         container.innerHTML = "";

          //для каждой категории картинок
         for (let i = 0; i < data['boards'].length; i++){

            container.innerHTML += tmpl_board   .replace('${board_title}', data['boards'][i]['title'])
                                                .replace('${board_num}', i);
                                                                                  
             }
    }

    //отрисовываем картинки для выбора фона доски
    function renderWallpapers(){
        //находим контейнер для обоев  
            let wallpapersContainer = document.getElementById('wallpapers');

            //находим шаблон для обоев
            let templateWallpapers = document.getElementById('tmpl-wallpapers').innerHTML;

            //для каждой категории картинок
            for (let i = 0; i<wallpaper.length; i++){

                //выводим картинки этой категории
                for (let j = 0; j<wallpaper[i]['image'].length; j++){

                    wallpapersContainer.innerHTML += templateWallpapers .replace('${image}', wallpaper[i]['image'][j])
                                                                        .replace('${image}', wallpaper[i]['image'][j]);
                                                                                    
                }
            }
    }

    //показываем/скрываем меню с обоями 
    function toggleWallpapaers(){

        //показать блок с обоями
        document.getElementById('changeBackground').classList.toggle('wallpapers-activ');
   
    }

    //показываем/скрываем меню с досками 
    function toggleBoardsList(){

        //показать блок с обоями
        document.getElementById('side-menu').classList.toggle('side-menu-activ');
    
    }

    //функция для замены обоев
    function boardChangeBackground() {

        //получаем ссылку на фон
        let background = event.target.getAttribute('attr-image');
    
        //обновляем фон в модели
        data['boards'][currentBoardId]['background'] = background;

        //сохраняем
        save();

        //перерисовываем
        renderBoards();

    }

    //функция переключения досок
    function changeBoard(){

        //определяем номер доски на котоую кликнули
        let num = event.target.getAttribute('data-num');

        //меняем текущий номер доски
        currentBoardId = num;

        //перерисовываем доски с учётом номера текущей доски
        renderBoards();

        //закрываем меню с досками
        toggleBoardsList();

        save();

    }    

    //функция рассыльщика
    function sender(){

        //бежим по всем доскам в модели
        for (let i = 0; i < data['boards'].length; i++) {
            //бежим по всем колонкам доски
            for (let j = 0; j < data['boards'][i]['columns'].length; j++) {
                //бежим по всем задачам
                for (let k = 0; k < data['boards'][i]['columns'][j]['cards'].length; k++) {

                    //делаем рассылку задачи, если текущее время совпадает со временем задачи
                    if (data['boards'][i]['columns'][j]['cards'][k]['time'] != '') {
                
                        //получаем текущее время и приводим его к такому же формату, как и time задачи (2022-12-07T17:37) 
                        let now = new Date();
                        let dateNow = now.toLocaleDateString();
                        let timeNow = now.toLocaleTimeString().slice(0, -3);
                        let dateNowFormatted = dateNow.substring(6) + "-" + dateNow.substring(3, 5) + "-" + dateNow.substring(0, 2) + "T" + timeNow;
                       
                        
                        if (data['boards'][i]['columns'][j]['cards'][k]['time'] == dateNowFormatted){
                       
                            //если время совпало, то делаем отправку этой задачи в телеграмм
                            sendMessage(data['boards'][i]['columns'][j]['cards'][k]['title'], chat_id);

                            //ставим отметку, что уже отправялось, затирая время
                            data['boards'][i]['columns'][j]['cards'][k]['time'] = '';
                        } else {
                            console.log(data['boards'][i]['columns'][j]['cards'][k]['time'] + "------------" + dateNowFormatted);
                        }

 
                    }
                }
            }

        save();
        }
    }

    //функция для отправки сообщения
    function sendMessage(text, chat_id){

        //формируем адрес запроса
        let url = "https://api.telegram.org/bot5762215975:AAFTUVjFrf4pwSEQakOTE-RpYusGBWNZe5U/sendMessage?chat_id=" + chat_id + "&text=" + text;
        
        //отправляем запрос на этот адрес
        let xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.send();
    }
